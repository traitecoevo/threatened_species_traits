# This file is automatically generated from traits.build
# package, via the file remake.yml.whisker:
# edit the file there (or the files that it includes).

packages:
  - traits.build

targets:

# Define generic targets
  all:
    depends:
      - threatened_species
      - export/data/curr/threatened_species.rds

# Load data resources
  schema:
    command: get_schema()

  resource_metadata:
    command: get_schema("config/metadata.yml",  I("metadata"))

  definitions:
    command: get_schema("config/traits.yml", I("traits"))

  unit_conversions:
    command: get_unit_conversions("config/unit_conversions.csv")

  taxon_list:
    command: read_csv_char("config/taxon_list.csv")

# Build each source
  Berthon_2018_config:
    command: >
      dataset_configure("data/Berthon_2018/metadata.yml",
                 definitions
                 )
  Berthon_2018_raw:
    command: >
      dataset_process("data/Berthon_2018/data.csv",
                  Berthon_2018_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  Berthon_2018:
    command: >
      dataset_update_taxonomy(Berthon_2018_raw,
                  taxon_list
                 )

  DCCEEW_2024_config:
    command: >
      dataset_configure("data/DCCEEW_2024/metadata.yml",
                 definitions
                 )
  DCCEEW_2024_raw:
    command: >
      dataset_process("data/DCCEEW_2024/data.csv",
                  DCCEEW_2024_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  DCCEEW_2024:
    command: >
      dataset_update_taxonomy(DCCEEW_2024_raw,
                  taxon_list
                 )

  Fensham_2020_config:
    command: >
      dataset_configure("data/Fensham_2020/metadata.yml",
                 definitions
                 )
  Fensham_2020_raw:
    command: >
      dataset_process("data/Fensham_2020/data.csv",
                  Fensham_2020_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  Fensham_2020:
    command: >
      dataset_update_taxonomy(Fensham_2020_raw,
                  taxon_list
                 )

  FernandezWinzer_2018_config:
    command: >
      dataset_configure("data/FernandezWinzer_2018/metadata.yml",
                 definitions
                 )
  FernandezWinzer_2018_raw:
    command: >
      dataset_process("data/FernandezWinzer_2018/data.csv",
                  FernandezWinzer_2018_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  FernandezWinzer_2018:
    command: >
      dataset_update_taxonomy(FernandezWinzer_2018_raw,
                  taxon_list
                 )

  Martino_2022_config:
    command: >
      dataset_configure("data/Martino_2022/metadata.yml",
                 definitions
                 )
  Martino_2022_raw:
    command: >
      dataset_process("data/Martino_2022/data.csv",
                  Martino_2022_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  Martino_2022:
    command: >
      dataset_update_taxonomy(Martino_2022_raw,
                  taxon_list
                 )

  Martino_2024_config:
    command: >
      dataset_configure("data/Martino_2024/metadata.yml",
                 definitions
                 )
  Martino_2024_raw:
    command: >
      dataset_process("data/Martino_2024/data.csv",
                  Martino_2024_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  Martino_2024:
    command: >
      dataset_update_taxonomy(Martino_2024_raw,
                  taxon_list
                 )

  McDougall_2024_config:
    command: >
      dataset_configure("data/McDougall_2024/metadata.yml",
                 definitions
                 )
  McDougall_2024_raw:
    command: >
      dataset_process("data/McDougall_2024/data.csv",
                  McDougall_2024_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  McDougall_2024:
    command: >
      dataset_update_taxonomy(McDougall_2024_raw,
                  taxon_list
                 )

  Pegg_2018_config:
    command: >
      dataset_configure("data/Pegg_2018/metadata.yml",
                 definitions
                 )
  Pegg_2018_raw:
    command: >
      dataset_process("data/Pegg_2018/data.csv",
                  Pegg_2018_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  Pegg_2018:
    command: >
      dataset_update_taxonomy(Pegg_2018_raw,
                  taxon_list
                 )

  Setterfield_2002_config:
    command: >
      dataset_configure("data/Setterfield_2002/metadata.yml",
                 definitions
                 )
  Setterfield_2002_raw:
    command: >
      dataset_process("data/Setterfield_2002/data.csv",
                  Setterfield_2002_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  Setterfield_2002:
    command: >
      dataset_update_taxonomy(Setterfield_2002_raw,
                  taxon_list
                 )

  Ward_2021_config:
    command: >
      dataset_configure("data/Ward_2021/metadata.yml",
                 definitions
                 )
  Ward_2021_raw:
    command: >
      dataset_process("data/Ward_2021/data.csv",
                  Ward_2021_config,
                  schema,
                  resource_metadata,
                  unit_conversions
                 )
  Ward_2021:
    command: >
      dataset_update_taxonomy(Ward_2021_raw,
                  taxon_list
                 )


  threatened_species_raw:
    command: >
      build_combine(
        Berthon_2018,
        DCCEEW_2024,
        Fensham_2020,
        FernandezWinzer_2018,
        Martino_2022,
        Martino_2024,
        McDougall_2024,
        Pegg_2018,
        Setterfield_2002,
        Ward_2021,
        NULL)

# Version information
  version_number:
    command: util_get_version("config/metadata.yml")

  git_SHA:
    command: util_get_SHA()
    depends:
      - .git/index

# Combine all the source into one resource
  threatened_species:
    command: build_add_version(threatened_species_raw, version_number, git_SHA)

# Save to file
  export/data/curr/threatened_species.rds:
    command: saveRDS(threatened_species, target_name)
